# expense-deployer/docker-compose.override.yml
# Development overrides - automatically loaded with docker compose up

services:
  postgres:
    ports:
      - "5432:5432"

  redis:
    ports:
      - "6379:6379"

  expense-engine:
    environment:
      APP_ENV: development
      LOG_LEVEL: debug
      ENABLE_GRPC_REFLECTION: "true"

  php:
    environment:
      APP_ENV: local
      APP_DEBUG: "true"
      LOG_LEVEL: debug
    volumes:
      # Hot reload: mount source code for live changes
      - ../expense-api:/var/www/html
      - ../expense-api/storage:/var/www/html/storage
      # Exclude vendor to use container's optimized vendor
      - /var/www/html/vendor

  nginx:
    volumes:
      - ../expense-api:/var/www/html
      - ../expense-api/docker/nginx/default.conf:/etc/nginx/conf.d/default.conf:ro

  queue-worker:
    environment:
      APP_ENV: local
      APP_DEBUG: "true"
    volumes:
      - ../expense-api:/var/www/html
      - ../expense-api/storage:/var/www/html/storage
      - /var/www/html/vendor
    # Faster polling in development
    command: php artisan queue:work redis --tries=3 --timeout=300 --sleep=1
